{
  "hooks": {
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## WORKFLOW ENFORCEMENT - SubagentStop Hook\n\nA subagent has completed. You MUST determine and execute the next workflow phase.\n\n### Check Workflow State\n\n```javascript\nconst state = workflowState.readState();\nconst completedAgent = state.phases.current;\nconst agentResult = // from the subagent output\n```\n\n### Decision Tree (MUST FOLLOW)\n\n1. **If implementation-agent completed**:\n   - MUST run deslop-work AND test-coverage-checker (parallel)\n   - ```javascript\n     await Promise.all([\n       Task({ subagent_type: 'next-task:deslop-work' }),\n       Task({ subagent_type: 'next-task:test-coverage-checker' })\n     ]);\n     ```\n   - Then Phase 9 (review loop) runs inline\n\n2. **If pre-review gates completed**:\n   - Phase 9 (review loop) runs INLINE in main orchestrator\n   - Review spawns parallel Task agents for each review pass\n   - After review completes, MUST run delivery-validator\n   - ```javascript\n     await Task({ subagent_type: 'next-task:delivery-validator' });\n     ```\n\n4. **If delivery-validator completed**:\n   - Check if approved: `agentResult.approved === true`\n   - If APPROVED: MUST run docs-updater\n     ```javascript\n     await Task({ subagent_type: 'next-task:docs-updater' });\n     ```\n   - If NOT APPROVED: Return to implementation with fix instructions\n\n5. **If docs-updater completed**:\n   - MUST invoke /ship command\n   - ```javascript\n     await Skill({ skill: 'ship:ship' });\n     ```\n\n### CRITICAL ENFORCEMENT\n\nNEVER skip deslop-work or test-coverage-checker.\nNEVER skip Phase 9 review loop.\nNEVER skip delivery-validator.\nNEVER skip docs-updater.\nNEVER create PR before /ship is invoked.\nNEVER push to remote before /ship is invoked.\n\n### Workflow Sequence (MANDATORY)\n\n```\nimplementation-agent\n        ↓ (SubagentStop)\npre-review gates (deslop-work + test-coverage-checker)\n        ↓ (SubagentStop)\nPhase 9: review loop (inline in main orchestrator)\n        ↓ (SubagentStop)\ndelivery-validator\n        ↓ (SubagentStop, if approved)\ndocs-updater\n        ↓ (SubagentStop)\n/ship command\n```\n\nReturn: {\"ok\": true, \"nextPhase\": \"<phase-name>\"}"
          }
        ]
      }
    ]
  }
}
